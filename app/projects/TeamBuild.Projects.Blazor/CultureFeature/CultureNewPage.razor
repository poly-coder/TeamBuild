@using TeamBuild.Projects.Application.CultureFeature
@attribute [Route(CultureRoutes.NewRoute)]
@inject NavigationManager Nav
@inject ICultureCommandService Service

<TbPageComponent Title="New Culture" Breadcrumbs="@Breadcrumbs">
    <ChildContent>
        <CultureNewView OnSave="HandleOnSave" />
    </ChildContent>
</TbPageComponent>

@code
{
    private IReadOnlyCollection<TbBreadcrumbItem> Breadcrumbs => [
        TbBreadcrumbItem.Create("Cultures", CultureRoutes.List(), TbIcon.List),
        TbBreadcrumbItem.Current("New Culture", TbIcon.Add)
    ];

    private async Task HandleOnSave(CultureNewView.FormModel form)
    {
        var success = await Service.DefineAsync(form.MapToCommand());

        var route = form.GoToDetails
            ? CultureRoutes.Details(success.Culture.CultureCode)
            : CultureRoutes.List();

        Nav.NavigateTo(route);
    }
}
